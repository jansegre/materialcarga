#{extends 'Application/layout.html' /}
#{set title:messages.get('home.title') /}
<div id="list">
<table>
<tr>
<th>&{'list.material'}</th>
<th>&{'list.entrada'}</th>
<th>&{'list.valunit'}</th>
<th>&{'list.valtotal'}</th>
<th></th>
<th></th>
</tr>
#{if !search}
<tr id="add">
<td><input type="text" class="inplace_field" name="material" form="addform" required autofocus /></td>
<td><input type="text" class="inplace_field" name="entrada" form="addform" required /></td>
<td><input type="text" class="inplace_field" name="valunit" form="addform" required /></td>
<td><input type="text" class="inplace_field" name="valtotal" form="addform" /></td>
<td>#{form @addInventario(), id:'addform'}#{/form}</td>
<td class="submit"><input class="submit" type="submit" id="submit" form="addform" value="+" /></td>
</tr>
#{/if}
#{paginate.list items:inventarios, as:'i'}
<tr class="inventario">
<td id="material-${i.id}" class="e">${i.material}</td>
<td id="entrada-${i.id}" class="e">${i.entrada}</td>
<td id="valunit-${i.id}" class="e">${i.valunit}</td>
<td id="valtotal-${i.id}" class="e">${i.valtotal}</td>
<td>${i.modificadoEm?.format("dd/MM/yyyy")}</td>
<td><form action="@{edit(i.id)}"><button type="submit">&gt;</button></form></td>
</tr>
#{/paginate.list}
#{else}
<tr>
<td>&{'list.empty'}</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
#{/else}
</table>
</div>
<nav id="controls">
#{paginate.summary items:inventarios /}
#{paginate.controls items:inventarios /}
</nav>
<script>
$(".inventario .e").editInPlace({
    bg_over: 'transparent',
    default_text: '',
    callback: function(el, n, o) {
        var m = /([a-z]+)-(\d+)/.exec(el), data = {}
        data['inventario.id'] = m[2]
        data['inventario.' + m[1]] = n
        // Save result
        $.ajax({
            url: '@{editInventario()}',
            type: 'PUT',
            data: data,
            success: function() {$('#' + el).html(n)},
            error: function() {$('#' + el).html(o)}
        })
        return true
    }
})
</script>